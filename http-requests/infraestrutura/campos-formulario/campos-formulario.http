### ========================================
### Campos de Formulário - CRUD Completo
### ========================================

### IMPORTANTE: Preencha esta variável com ID real após criar/buscar um campo
@campoId = COLE-O-ID-DO-CAMPO-AQUI

### ========================================

### 1. Criar Campo de Formulário
POST {{baseUrl}}/infraestrutura/campos-formulario
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "nomeCampo": "unidade_medida",
  "descricao": "Unidade de medida para resultados de exames"
}

### Expected Response:
# Status: 201 Created
# {
#   "id": "uuid",
#   "nomeCampo": "unidade_medida",
#   "descricao": "Unidade de medida para resultados de exames",
#   "ativo": true,
#   "alternativas": [],
#   "createdAt": "2025-11-05T...",
#   "updatedAt": "2025-11-05T...",
#   "createdBy": "user-id",
#   "updatedBy": null
# }

### ========================================
### 2. Listar Todos os Campos
### ========================================
GET {{baseUrl}}/infraestrutura/campos-formulario
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

### Expected Response:
# Status: 200 OK
# Array com todos os campos de formulário

### ========================================
### 3. Listar Apenas Campos Ativos
### ========================================
GET {{baseUrl}}/infraestrutura/campos-formulario/ativos
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

### Expected Response:
# Status: 200 OK
# Array com campos ativos (ativo: true)

### ========================================
### 4. Buscar Campos com Filtros (NOVO)
### ========================================

### 4.1. Buscar por termo na descrição
GET {{baseUrl}}/infraestrutura/campos-formulario/search?termo=medida
Authorization: Bearer {{token}}

### Expected Response:
# Status: 200 OK
# Array com campos que contêm "medida" na descrição ou no nome

### 4.2. Buscar por nome específico do campo
GET {{baseUrl}}/infraestrutura/campos-formulario/search?nomeCampo=unidade_medida
Authorization: Bearer {{token}}

### Expected Response:
# Status: 200 OK
# Array com o campo específico e suas alternativas

### 4.3. Buscar apenas campos ativos
GET {{baseUrl}}/infraestrutura/campos-formulario/search?ativo=true
Authorization: Bearer {{token}}

### Expected Response:
# Status: 200 OK
# Array com campos onde ativo = true

### 4.4. Buscar apenas campos inativos
GET {{baseUrl}}/infraestrutura/campos-formulario/search?ativo=false
Authorization: Bearer {{token}}

### Expected Response:
# Status: 200 OK
# Array com campos onde ativo = false

### 4.5. Buscar com múltiplos filtros combinados
GET {{baseUrl}}/infraestrutura/campos-formulario/search?termo=exame&ativo=true
Authorization: Bearer {{token}}

### Expected Response:
# Status: 200 OK
# Array com campos ativos que contêm "exame" na descrição ou nome

### 4.6. Buscar sem filtros (retorna todos)
GET {{baseUrl}}/infraestrutura/campos-formulario/search
Authorization: Bearer {{token}}

### Expected Response:
# Status: 200 OK
# Array com todos os campos (equivalente ao findAll)

### ========================================
### 5. Buscar Campo por ID
### ========================================
GET {{baseUrl}}/infraestrutura/campos-formulario/{{campoId}}
Authorization: Bearer {{token}}

### Expected Response:
# Status: 200 OK
# Campo com suas alternativas

### ========================================
### 6. Buscar Campo por Nome (ENUM)
### ========================================
GET {{baseUrl}}/infraestrutura/campos-formulario/nome/unidade_medida
Authorization: Bearer {{token}}

### Expected Response:
# Status: 200 OK
# Campo específico com alternativas

### ========================================
### Valores Válidos para nomeCampo (ENUM):
### ========================================
# - tipo_exames
# - especialidade
# - grupo
# - subgrupo
# - setor
# - metodologia
# - unidade_medida
# - amostra
# - regiao_coleta
# - volume_minimo
# - estabilidade

### ========================================
### 7. Atualizar Campo
### ========================================
PATCH {{baseUrl}}/infraestrutura/campos-formulario/{{campoId}}
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "descricao": "Descrição atualizada do campo"
}

### Expected Response:
# Status: 200 OK
# Campo atualizado com novo updatedBy

### ========================================
### 8. Alternar Status (Ativo/Inativo)
### ========================================
PATCH {{baseUrl}}/infraestrutura/campos-formulario/{{campoId}}/toggle-status
Authorization: Bearer {{token}}

### Expected Response:
# Status: 200 OK
# Campo com status alternado (ativo -> inativo ou inativo -> ativo)

### ========================================
### 9. Remover Campo (Soft Delete)
### ========================================
DELETE {{baseUrl}}/infraestrutura/campos-formulario/{{campoId}}
Authorization: Bearer {{token}}

### Expected Response:
# Status: 204 No Content
# Campo marcado como inativo (soft delete)

### ========================================
### Testes de Erro
### ========================================

### Criar campo duplicado (deve falhar)
POST {{baseUrl}}/infraestrutura/campos-formulario
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nomeCampo": "unidade_medida",
  "descricao": "Tentando criar campo duplicado"
}

### Expected Response:
# Status: 409 Conflict
# { "message": "Campo unidade_medida já está cadastrado" }

### Buscar campo inexistente
GET {{baseUrl}}/infraestrutura/campos-formulario/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{token}}

### Expected Response:
# Status: 404 Not Found
# { "message": "Campo não encontrado" }

### Criar campo com nome inválido
POST {{baseUrl}}/infraestrutura/campos-formulario
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nomeCampo": "campo_invalido",
  "descricao": "Testando campo com nome não existente no enum"
}

### Expected Response:
# Status: 400 Bad Request
# { "message": "Nome do campo inválido" }
