### ==========================================================
### FLUXO COMPLETO - ANALISADOR HEMATOLOGICO
### ==========================================================

### 1. Criar analisador hematologico completo
POST {{baseUrl}}/configuracoes/estrutura/equipamentos
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigoEquipamento": "EQ-HEMA-001",
  "nome": "Analisador Hematologico Sysmex XN-1000",
  "tipo": "analisador",
  "marca": "Sysmex",
  "modelo": "XN-1000",
  "numeroSerie": "SYS-XN1000-2024-001",
  "patrimonio": "PAT-HEMA-2024-001",
  "setorId": "{{setorHematologiaId}}",
  "salaId": "{{salaHematologiaId}}",
  "dataAquisicao": "2024-01-10",
  "valorAquisicao": 320000.00,
  "fornecedorId": "{{fornecedorSysmexId}}",
  "status": "operante",
  "ultimaManutencao": "2024-09-10",
  "proximaManutencao": "2025-03-10",
  "ultimaCalibracao": "2024-10-01",
  "proximaCalibracao": "2025-04-01",
  "observacoes": "Analisador hematologico de alta performance com tecnologia de fluorescencia a laser. Capacidade de 100 amostras/hora. Inclui modulos CBC, DIFF e RETIC. Sistema automatizado com interface LIS.",
  "manuais": [
    "https://storage.lab.com/manuais/sysmex-xn1000-manual-operador.pdf",
    "https://storage.lab.com/manuais/sysmex-xn1000-manual-manutencao.pdf",
    "https://storage.lab.com/manuais/sysmex-xn1000-calibracao.pdf",
    "https://storage.lab.com/manuais/sysmex-xn1000-troubleshooting.pdf",
    "https://storage.lab.com/manuais/sysmex-xn1000-interface-lis.pdf"
  ]
}

### 2. Verificar se foi criado
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/codigo/EQ-HEMA-001
Authorization: Bearer {{token}}

### 3. Registrar primeira calibracao
POST {{baseUrl}}/configuracoes/estrutura/equipamentos/{{$guid}}/calibracoes
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "data": "2024-10-01",
  "certificado": "CERT-SYSMEX-2024-001",
  "laboratorio": "Sysmex do Brasil - Servico Tecnico Autorizado",
  "realizadoPor": "Eng. Roberto Santos CREA-SP 456789",
  "custo": 2500.00,
  "proximaCalibracao": "2025-04-01",
  "resultado": "Conforme - Todos os parametros aprovados",
  "observacoes": "Calibracao completa dos canais WBC, RBC, PLT, HGB. Controles niveis 1, 2 e 3 aprovados. Certificado com rastreabilidade internacional."
}

### 4. Registrar primeira manutencao preventiva
POST {{baseUrl}}/configuracoes/estrutura/equipamentos/{{$guid}}/manutencoes
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "tipo": "preventiva",
  "data": "2024-09-10",
  "descricao": "Manutencao preventiva trimestral - Procedimento completo conforme manual do fabricante",
  "realizadoPor": "Tecnico Especializado Jose Silva - Sysmex do Brasil",
  "custo": 3200.00,
  "proximaManutencao": "2025-03-10",
  "observacoes": "Realizados: limpeza dos canais, troca de tubulacao, verificacao de bombas, limpeza optica, atualizacao de software v2.5, teste de controle de qualidade. Equipamento operando perfeitamente."
}

### 5. Atualizar com informacoes adicionais
PATCH {{baseUrl}}/configuracoes/estrutura/equipamentos/{{$guid}}
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "observacoes": "Analisador hematologico Sysmex XN-1000 - Principal equipamento do setor de Hematologia. Opera 24/7 com contrato de manutencao full. Interface integrada ao LIS via HL7. Responsavel tecnico: Dra. Ana Paula Costa (CRBM 54321). Controle de qualidade diario com materiais Sysmex. Backup: Analisador Sysmex XS-1000i."
}

### 6. Consultar historico completo
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/{{$guid}}
Authorization: Bearer {{token}}

### 7. Listar manutencoes realizadas
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/{{$guid}}/manutencoes
Authorization: Bearer {{token}}

### 8. Listar calibracoes realizadas
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/{{$guid}}/calibracoes
Authorization: Bearer {{token}}

### ==========================================================
### FLUXO COMPLETO - CENTRIFUGA REFRIGERADA
### ==========================================================

### 1. Criar centrifuga refrigerada
POST {{baseUrl}}/configuracoes/estrutura/equipamentos
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigoEquipamento": "EQ-CENT-001",
  "nome": "Centrifuga Refrigerada Eppendorf 5810R",
  "tipo": "centrifuga",
  "marca": "Eppendorf",
  "modelo": "5810R",
  "numeroSerie": "EP-5810R-2024-010",
  "patrimonio": "PAT-CENT-2024-001",
  "setorId": "{{setorBioquimicaId}}",
  "salaId": "{{salaBioquimicaId}}",
  "dataAquisicao": "2024-02-15",
  "valorAquisicao": 38500.00,
  "fornecedorId": "{{fornecedorEppendorfId}}",
  "status": "operante",
  "ultimaManutencao": "2024-10-01",
  "proximaManutencao": "2025-04-01",
  "observacoes": "Centrifuga refrigerada com capacidade para 4x250ml ou 2x500ml. Velocidade maxima 14.000 RPM (20.913 x g). Temperatura de -9C a +40C. Display digital com controle de temperatura, tempo e velocidade. Sistema de seguranca automatica.",
  "manuais": [
    "https://storage.lab.com/manuais/eppendorf-5810r-manual-pt.pdf",
    "https://storage.lab.com/manuais/eppendorf-5810r-rotores.pdf"
  ]
}

### 2. Verificar criacao
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/codigo/EQ-CENT-001
Authorization: Bearer {{token}}

### 3. Registrar manutencao preventiva
POST {{baseUrl}}/configuracoes/estrutura/equipamentos/{{$guid}}/manutencoes
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "tipo": "preventiva",
  "data": "2024-10-01",
  "descricao": "Manutencao preventiva semestral",
  "realizadoPor": "Eppendorf Service - Tecnico Marcos Lima",
  "custo": 1200.00,
  "proximaManutencao": "2025-04-01",
  "observacoes": "Verificacao de rotores, limpeza geral, teste de refrigeracao, calibracao de velocidade. Tudo OK."
}

### ==========================================================
### FLUXO COMPLETO - MICROSCOPIO TRINOCULAR
### ==========================================================

### 1. Criar microscopio trinocular
POST {{baseUrl}}/configuracoes/estrutura/equipamentos
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigoEquipamento": "EQ-MICRO-001",
  "nome": "Microscopio Trinocular Olympus CX43",
  "tipo": "microscopio",
  "marca": "Olympus",
  "modelo": "CX43",
  "numeroSerie": "OLY-CX43-2024-015",
  "patrimonio": "PAT-MICRO-2024-001",
  "setorId": "{{setorMicrobiologiaId}}",
  "salaId": "{{salaMicrobiologiaId}}",
  "dataAquisicao": "2024-03-20",
  "valorAquisicao": 18900.00,
  "fornecedorId": "{{fornecedorOlympusId}}",
  "status": "operante",
  "ultimaManutencao": "2024-09-20",
  "proximaManutencao": "2025-03-20",
  "observacoes": "Microscopio trinocular com camera digital integrada. Iluminacao LED de alta intensidade. Objetivas planachromaticas 4x, 10x, 40x e 100x (oleo). Condensador Abbe NA 1.25. Sistema de documentacao digital integrado ao LIS.",
  "manuais": [
    "https://storage.lab.com/manuais/olympus-cx43-manual-usuario.pdf",
    "https://storage.lab.com/manuais/olympus-cx43-camera-digital.pdf"
  ]
}

### 2. Verificar criacao
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/codigo/EQ-MICRO-001
Authorization: Bearer {{token}}

### ==========================================================
### FLUXO COMPLETO - AUTOCLAVE HOSPITALAR
### ==========================================================

### 1. Criar autoclave
POST {{baseUrl}}/configuracoes/estrutura/equipamentos
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigoEquipamento": "EQ-AUTO-001",
  "nome": "Autoclave Horizontal 300L Phoenix",
  "tipo": "autoclave",
  "marca": "Phoenix",
  "modelo": "AH-300",
  "numeroSerie": "PHX-AH300-2024-002",
  "patrimonio": "PAT-AUTO-2024-001",
  "setorId": "{{setorEsterilizacaoId}}",
  "salaId": "{{salaEsterilizacaoId}}",
  "dataAquisicao": "2024-01-20",
  "valorAquisicao": 45000.00,
  "fornecedorId": "{{fornecedorPhoenixId}}",
  "status": "operante",
  "ultimaManutencao": "2024-10-05",
  "proximaManutencao": "2025-01-05",
  "ultimaCalibracao": "2024-10-05",
  "proximaCalibracao": "2025-01-05",
  "observacoes": "Autoclave horizontal para esterilizacao de grande volume. Capacidade 300 litros. Temperatura ate 134C. Pressao ate 2.2 bar. Sistema automatico com 5 programas pre-definidos. Controle digital com registro de ciclos. Validacao biologica mensal.",
  "manuais": [
    "https://storage.lab.com/manuais/phoenix-ah300-manual.pdf",
    "https://storage.lab.com/manuais/phoenix-ah300-validacao.pdf",
    "https://storage.lab.com/manuais/phoenix-ah300-protocolos-esterilizacao.pdf"
  ]
}

### 2. Registrar calibracao trimestral
POST {{baseUrl}}/configuracoes/estrutura/equipamentos/{{$guid}}/calibracoes
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "data": "2024-10-05",
  "certificado": "CERT-AUTO-2024-Q4",
  "laboratorio": "Phoenix Equipamentos - Divisao de Calibracao",
  "realizadoPor": "Eng. Patricia Alves CREA-RJ 789012",
  "custo": 1800.00,
  "proximaCalibracao": "2025-01-05",
  "resultado": "Conforme - Parametros dentro das especificacoes",
  "observacoes": "Calibracao de temperatura (termometro padrao rastreado), pressao (manometro calibrado) e tempo. Teste biologico com Geobacillus stearothermophilus - Aprovado. Certificado com rastreabilidade RBC."
}

### 3. Simular falha e colocar em manutencao
PATCH {{baseUrl}}/configuracoes/estrutura/equipamentos/{{$guid}}
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "status": "manutencao",
  "observacoes": "Equipamento em manutencao corretiva - Falha na valvula de seguranca. Peca em garantia. Previsao de retorno: 5 dias uteis. Processos de esterilizacao sendo realizados na autoclave backup AH-200."
}

### 4. Retornar de manutencao
PATCH {{baseUrl}}/configuracoes/estrutura/equipamentos/{{$guid}}
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "status": "operante",
  "ultimaManutencao": "2024-10-10",
  "proximaManutencao": "2025-01-10",
  "observacoes": "Manutencao corretiva concluida. Valvula de seguranca substituida. Realizados testes de pressao, temperatura e ciclo completo. Teste biologico aprovado. Equipamento liberado para uso."
}

### ==========================================================
### FLUXO COMPLETO - FREEZER ULTRA-BAIXA TEMPERATURA
### ==========================================================

### 1. Criar freezer ultra-baixo
POST {{baseUrl}}/configuracoes/estrutura/equipamentos
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigoEquipamento": "EQ-FREEZ-001",
  "nome": "Freezer Ultra-Baixa Temperatura -80C",
  "tipo": "freezer",
  "marca": "Thermo Fisher",
  "modelo": "TSX600",
  "numeroSerie": "TFS-TSX600-2024-001",
  "patrimonio": "PAT-FREEZ-2024-001",
  "setorId": "{{setorBiologiaMolecularId}}",
  "salaId": "{{salaBiologiaMolecularId}}",
  "dataAquisicao": "2024-02-01",
  "valorAquisicao": 128000.00,
  "fornecedorId": "{{fornecedorThermoFisherId}}",
  "status": "operante",
  "ultimaManutencao": "2024-09-01",
  "proximaManutencao": "2024-12-01",
  "observacoes": "Freezer de ultra-baixa temperatura -80C para armazenamento de amostras biologicas, DNA, RNA, proteinas e reagentes sensiveis. Capacidade 600 litros. Sistema de refrigeracao em cascata. Monitoramento remoto 24/7 via IoT. Alarme de temperatura com notificacao SMS e email. Sistema de backup de energia (No-break dedicado). Registro continuo de temperatura com datalogger. Capacidade: 48.000 tubos criogenicos de 2ml.",
  "manuais": [
    "https://storage.lab.com/manuais/thermofisher-tsx600-manual.pdf",
    "https://storage.lab.com/manuais/thermofisher-tsx600-alarmes.pdf",
    "https://storage.lab.com/manuais/thermofisher-tsx600-organizacao.pdf"
  ]
}

### 2. Verificar status e disponibilidade
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/codigo/EQ-FREEZ-001
Authorization: Bearer {{token}}

### 3. Registrar manutencao preventiva
POST {{baseUrl}}/configuracoes/estrutura/equipamentos/{{$guid}}/manutencoes
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "tipo": "preventiva",
  "data": "2024-09-01",
  "descricao": "Manutencao preventiva trimestral - Procedimento sem abertura de porta",
  "realizadoPor": "Thermo Fisher Service - Tecnico Especializado Eduardo Martins",
  "custo": 4500.00,
  "proximaManutencao": "2024-12-01",
  "observacoes": "Verificacao externa: teste de alarmes, verificacao de compressores, limpeza de condensadores, teste de sistema de monitoramento remoto, verificacao de vedacao de porta, teste de backup de energia. Temperatura estavel em -80C. Sistema operando perfeitamente. Sem necessidade de abertura."
}

### ==========================================================
### CENARIOS DE GESTAO DE FROTA DE EQUIPAMENTOS
### ==========================================================

### Listar todos os equipamentos criados neste fluxo
GET {{baseUrl}}/configuracoes/estrutura/equipamentos
Authorization: Bearer {{token}}

### Obter estatisticas gerais
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/estatisticas
Authorization: Bearer {{token}}

### Listar equipamentos com manutencao proxima
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/manutencao/proxima
Authorization: Bearer {{token}}

### Listar equipamentos com calibracao proxima
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/calibracao/proxima
Authorization: Bearer {{token}}

### Listar equipamentos por setor
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/setor/{{setorHematologiaId}}
Authorization: Bearer {{token}}

### Buscar equipamentos por marca
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/marca/Sysmex
Authorization: Bearer {{token}}

### Listar equipamentos acima de 100mil
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/valor?min=100000
Authorization: Bearer {{token}}

### ==========================================================
### CENARIOS DE ERRO E VALIDACOES
### ==========================================================

### Tentar criar equipamento com codigo duplicado
POST {{baseUrl}}/configuracoes/estrutura/equipamentos
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigoEquipamento": "EQ-HEMA-001",
  "nome": "Equipamento Duplicado",
  "tipo": "analisador"
}

### Expected Response: 400 Bad Request - Codigo ja existe

###

### Tentar criar equipamento com numero de serie duplicado
POST {{baseUrl}}/configuracoes/estrutura/equipamentos
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigoEquipamento": "EQ-NOVO-001",
  "nome": "Equipamento Novo",
  "tipo": "analisador",
  "numeroSerie": "SYS-XN1000-2024-001"
}

### Expected Response: 400 Bad Request - Numero de serie ja existe

###

### Tentar criar equipamento com patrimonio duplicado
POST {{baseUrl}}/configuracoes/estrutura/equipamentos
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigoEquipamento": "EQ-NOVO-002",
  "nome": "Equipamento Novo 2",
  "tipo": "centrifuga",
  "patrimonio": "PAT-HEMA-2024-001"
}

### Expected Response: 400 Bad Request - Patrimonio ja existe

###

### Buscar equipamento inexistente
GET {{baseUrl}}/configuracoes/estrutura/equipamentos/codigo/EQ-INEXISTENTE
Authorization: Bearer {{token}}

### Expected Response: 404 Not Found

###
