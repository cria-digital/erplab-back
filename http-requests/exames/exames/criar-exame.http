###
### Campos de Formulário utilizados (FK para alternativas):
### - tipo_exame_id, metodologia_id, grupo_id, especialidade_id, unidade_medida_id
### - amostra_enviar_id, tipo_recipiente_id, estabilidade_id, volume_minimo_id
### - regiao_coleta_ids (array de IDs)
###
### Vínculos com outras entidades:
### - laboratorio_apoio_id: FK para laboratório de apoio (GET /api/v1/relacionamento/laboratorios)
### - telemedicina_id: FK para telemedicina (GET /api/v1/relacionamento/telemedicina)
### - unidade_destino_id: FK para unidade de saúde destino (GET /api/v1/cadastros/unidades-saude)
###
### formatos_laudo: Array de strings com formatos aceitos
###   Opções: "PDF", "XML", "HTML", "TEXTO", "FORMULARIO", "DICOM"
###
### tipo_realizacao: "interno", "apoio" ou "telemedicina"
### envio_automatico: "sim" ou "nao"
###
### Para obter os IDs disponíveis: GET /api/v1/infraestrutura/campos-formulario
###

### Criar um novo exame - Hemograma Completo
POST {{baseUrl}}/exames/exames
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigo_interno": "HEMOG001",
  "nome": "Hemograma Completo",
  "sinonimos": ["Hemograma", "Contagem de células", "CBC"],
  "codigo_cbhpm": "40304361",
  "codigo_tuss": "40304361",
  "codigo_amb": "28.01.001-2",
  "codigo_loinc": "58410-2",
  "codigo_sus": "0202010503",
  "tipo_exame_id": "{{tipoExameId}}",
  "categoria": "laboratorio",
  "subgrupo_id": "{{subgrupoId}}",
  "setor_id": "{{setorId}}",
  "metodologia_id": "{{metodologiaId}}",
  "especialidade_requerida": "nao",
  "grupo_id": "{{grupoId}}",
  "peso": 100,

  "requer_peso": false,
  "requer_altura": false,
  "requer_volume": true,
  "termo_consentimento": false,

  "volume_min": 2.5,
  "volume_ideal": 5.0,
  "unidade_medida_id": "{{unidadeMedidaId}}",
  "amostra_id": "{{amostraId}}",
  "amostra_enviar_id": "{{amostraEnviarId}}",
  "tipo_recipiente_id": "{{tipoRecipienteId}}",
  "regiao_coleta_ids": ["{{regiaoColetaId1}}", "{{regiaoColetaId2}}"],
  "estabilidade_id": "{{estabilidadeId}}",
  "volume_minimo_id": "{{volumeMinimoId}}",
  "formatos_laudo": ["PDF", "XML"],

  "necessita_preparo": "sim",
  "requisitos": "Jejum de 4 horas",
  "tipo_realizacao": "interno",
  "laboratorio_apoio_id": "{{laboratorioApoioId}}",
  "telemedicina_id": "{{telemedicinaId}}",
  "unidade_destino_id": "{{unidadeDestinoId}}",
  "envio_automatico": "nao",
  "prazo_entrega_dias": 1,
  "formato_prazo": "1 dia útil",
  "tem_valores_referencia": "sim",
  "valores_referencia": {
    "adulto_masculino": {
      "hemoglobina": { "min": 13.5, "max": 17.5, "unidade": "g/dL" },
      "hematocrito": { "min": 39, "max": 50, "unidade": "%" }
    },
    "adulto_feminino": {
      "hemoglobina": { "min": 12.0, "max": 15.5, "unidade": "g/dL" },
      "hematocrito": { "min": 35, "max": 45, "unidade": "%" }
    }
  },
  "tecnica_coleta": "Punção venosa periférica",
  "distribuicao": "Homogeneizar tubo, processar em até 4 horas",
  "rejeicao": "Hemólise, coágulos, volume insuficiente",
  "links_uteis": "https://www.fleury.com.br/manual-de-exames/hemograma",

  "preparo_geral": "Jejum de 4 horas. Evitar exercícios físicos intensos 24h antes.",
  "preparo_feminino": "Jejum de 4 horas. Informar se está menstruada ou gestante.",
  "preparo_infantil": "Jejum de 2 horas para crianças até 5 anos.",

  "coleta_geral": "Coletar em tubo EDTA (tampa roxa). Volume mínimo: 2,5mL.",
  "coleta_feminino": "Coletar em tubo EDTA (tampa roxa). Anotar DUM se aplicável.",
  "coleta_infantil": "Coletar com agulha pediátrica em tubo EDTA. Volume mínimo: 1mL.",

  "lembrete_coletora": "Homogeneizar suavemente o tubo 8-10 vezes após coleta",
  "lembrete_recepcionista_agendamento": "Verificar se paciente está em jejum de 4 horas",
  "lembrete_recepcionista_os": "Exame deve ser coletado em tubo EDTA (tampa roxa)",

  "unidades_ids": ["{{unidadeId}}"],

  "status": "ativo"
}

### Expected Response
# Status: 201 Created
# {
#   "message": "Exame criado com sucesso",
#   "data": {
#     "id": "uuid",
#     "codigo_interno": "HEMOG001",
#     "nome": "Hemograma Completo",
#     ...
#   }
# }

###

### Criar exame de imagem - Raio-X Tórax
POST {{baseUrl}}/exames/exames
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigo_interno": "RX001",
  "nome": "Radiografia de Tórax PA e Perfil",
  "sinonimos": ["Raio-X Tórax", "RX Tórax"],
  "codigo_tuss": "41001010",
  "tipo_exame_id": "{{tipoExameImagemId}}",
  "categoria": "imagem",
  "metodologia_id": "{{metodologiaRadiologiaId}}",
  "especialidade_requerida": "sim",
  "especialidade_id": "{{especialidadeRadiologiaId}}",
  "necessita_preparo": "nao",
  "tipo_realizacao": "interno",
  "prazo_entrega_dias": 1,
  "formato_prazo": "24 horas",
  "formatos_laudo": ["PDF", "DICOM"],
  "rejeicao": "Imagem borrada, paciente em movimento",
  "links_uteis": "https://www.fleury.com.br/manual-de-exames/raio-x-torax",
  "preparo_geral": "Retirar objetos metálicos",
  "preparo_feminino": "Informar possibilidade de gravidez",
  "status": "ativo"
}

###

### Criar exame enviado para Laboratório de Apoio
POST {{baseUrl}}/exames/exames
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigo_interno": "TSH001",
  "nome": "TSH - Hormônio Tireoestimulante",
  "sinonimos": ["TSH", "Tireotrofina"],
  "codigo_tuss": "40316521",
  "tipo_exame_id": "{{tipoExameId}}",
  "categoria": "laboratorio",
  "metodologia_id": "{{metodologiaId}}",
  "amostra_id": "{{amostraId}}",
  "necessita_preparo": "nao",
  "tipo_realizacao": "apoio",
  "laboratorio_apoio_id": "{{laboratorioApoioId}}",
  "envio_automatico": "sim",
  "prazo_entrega_dias": 3,
  "formato_prazo": "3 dias úteis",
  "formatos_laudo": ["PDF", "XML"],
  "preparo_geral": "Não necessita jejum",
  "status": "ativo"
}

###

### Criar exame de Telemedicina
POST {{baseUrl}}/exames/exames
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigo_interno": "ECG001",
  "nome": "Eletrocardiograma com Laudo",
  "sinonimos": ["ECG", "EKG"],
  "codigo_tuss": "40101010",
  "tipo_exame_id": "{{tipoExameImagemId}}",
  "categoria": "procedimento",
  "metodologia_id": "{{metodologiaId}}",
  "especialidade_requerida": "sim",
  "especialidade_id": "{{especialidadeCardiologiaId}}",
  "necessita_preparo": "nao",
  "tipo_realizacao": "telemedicina",
  "telemedicina_id": "{{telemedicinaId}}",
  "envio_automatico": "sim",
  "prazo_entrega_dias": 1,
  "formato_prazo": "24 horas",
  "formatos_laudo": ["PDF"],
  "preparo_geral": "Repouso de 10 minutos antes do exame",
  "status": "ativo"
}
