### =================================================
### FLUXO COMPLETO - CRIAÇÃO DE FORMULÁRIO ANAMNESE
### =================================================

### 1. Criar formulário de anamnese
POST {{baseUrl}}/formularios
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigoFormulario": "ANAM_COMPLETA_001",
  "nomeFormulario": "Anamnese Completa - Clínica Geral",
  "descricao": "Formulário completo de anamnese para primeira consulta na clínica geral",
  "tipo": "anamnese",
  "categoria": "clinico",
  "versao": 1,
  "unidadeSaudeId": "{{userId}}",
  "tags": ["anamnese", "primeira-consulta", "clinica-geral", "completo"],
  "configuracoes": {
    "permitirSalvarParcial": true,
    "exigirAssinaturaDigital": false,
    "tempoLimiteMinutos": 45,
    "notificarProfissional": true,
    "permitirEdicaoApósEnvio": false,
    "calcularScoreRisco": true
  },
  "metadados": {
    "autor": "Dr. Carlos Medeiros",
    "especialidade": "Clínica Geral",
    "protocolo": "CFM-ANAM-2025",
    "versaoMinimaSistema": "1.0.0",
    "dataAprovacao": "2025-01-21"
  },
  "observacoes": "Formulário padrão aprovado pelo corpo clínico para primeira consulta"
}

### 2. Verificar se foi criado
GET {{baseUrl}}/formularios/codigo/ANAM_COMPLETA_001
Authorization: Bearer {{token}}

### 3. Validar formulário (ainda sem campos)
POST {{baseUrl}}/formularios/{{$guid}}/validar
Authorization: Bearer {{token}}

### 4. Atualizar com configurações adicionais
PATCH {{baseUrl}}/formularios/{{$guid}}
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "configuracoes": {
    "permitirSalvarParcial": true,
    "exigirAssinaturaDigital": true,
    "tempoLimiteMinutos": 60,
    "notificarProfissional": true,
    "enviarCopiaEmail": true,
    "gerarRelatorioAutomatico": true
  }
}

### 5. Tentar publicar (deve falhar - sem campos)
POST {{baseUrl}}/formularios/{{$guid}}/publicar
Authorization: Bearer {{token}}

### ================================================
### FLUXO COMPLETO - QUESTIONÁRIO DE SATISFAÇÃO
### ================================================

### 1. Criar questionário de satisfação
POST {{baseUrl}}/formularios
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigoFormulario": "SAT_POS_CONSULTA_001",
  "nomeFormulario": "Avaliação de Satisfação Pós-Consulta",
  "descricao": "Questionário para avaliar a satisfação do paciente após a consulta médica",
  "tipo": "questionario",
  "categoria": "satisfacao",
  "versao": 1,
  "unidadeSaudeId": "{{userId}}",
  "tags": ["satisfacao", "pos-consulta", "qualidade", "nps"],
  "configuracoes": {
    "anonimo": true,
    "permitirSalvarParcial": false,
    "exigirAssinaturaDigital": false,
    "tempoLimiteMinutos": 10,
    "enviarPorEmail": true,
    "calcularNPS": true
  },
  "metadados": {
    "objetivo": "Melhoria contínua da qualidade do atendimento",
    "frequencia": "Pós-consulta",
    "responsavel": "Coordenação de Qualidade",
    "revisao": "Trimestral"
  },
  "observacoes": "Questionário baseado no modelo NPS para avaliação contínua"
}

### 2. Verificar criação
GET {{baseUrl}}/formularios/codigo/SAT_POS_CONSULTA_001
Authorization: Bearer {{token}}

### ===============================================
### FLUXO COMPLETO - TERMO DE CONSENTIMENTO
### ===============================================

### 1. Criar termo de consentimento
POST {{baseUrl}}/formularios
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigoFormulario": "TCLE_PROCEDIMENTO_001",
  "nomeFormulario": "Termo de Consentimento Livre e Esclarecido - Procedimentos",
  "descricao": "TCLE para procedimentos médicos invasivos e cirúrgicos",
  "tipo": "consentimento",
  "categoria": "legal",
  "versao": 1,
  "unidadeSaudeId": "{{userId}}",
  "tags": ["tcle", "consentimento", "procedimento", "legal", "obrigatorio"],
  "configuracoes": {
    "permitirSalvarParcial": false,
    "exigirAssinaturaDigital": true,
    "obrigatorioAntesProcedimento": true,
    "validadeDias": 30,
    "requerDuasAssinaturas": true,
    "gerarCertificadoDigital": true
  },
  "metadados": {
    "baseLegal": "Resolução CFM 2.217/2018",
    "revisaoJuridica": "Aprovado",
    "validadeJuridica": "2025-12-31",
    "responsavelLegal": "Dr. Roberto Advogado OAB/SP 123456"
  },
  "observacoes": "Documento legal obrigatório com validade jurídica plena"
}

### 2. Verificar criação
GET {{baseUrl}}/formularios/codigo/TCLE_PROCEDIMENTO_001
Authorization: Bearer {{token}}

### ============================================
### FLUXO COMPLETO - FORMULÁRIO DE TRIAGEM
### ============================================

### 1. Criar formulário de triagem
POST {{baseUrl}}/formularios
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigoFormulario": "TRIAG_EMERGENCIA_001",
  "nomeFormulario": "Triagem de Emergência - Protocolo Manchester",
  "descricao": "Formulário de triagem para classificação de risco em emergência",
  "tipo": "triagem",
  "categoria": "emergencia",
  "versao": 1,
  "unidadeSaudeId": "{{userId}}",
  "tags": ["triagem", "emergencia", "manchester", "classificacao-risco"],
  "configuracoes": {
    "permitirSalvarParcial": false,
    "preenchimentoObrigatorio": true,
    "calcularRisco": true,
    "alertarAltoRisco": true,
    "tempoMaximoPreenchimento": 5,
    "notificarEquipeMedica": true
  },
  "metadados": {
    "protocolo": "Manchester Triage System v2025",
    "validadeProtocolo": "2025-12-31",
    "aprovadoPor": "Comissão de Emergência",
    "treinamentoObrigatorio": true
  },
  "observacoes": "Protocolo internacional de classificação de risco em emergência"
}

### 2. Verificar criação
GET {{baseUrl}}/formularios/codigo/TRIAG_EMERGENCIA_001
Authorization: Bearer {{token}}

### ===============================
### OPERAÇÕES DE GERENCIAMENTO
### ===============================

### Listar todos os formulários criados
GET {{baseUrl}}/formularios
Authorization: Bearer {{token}}

### Pesquisar formulários por categoria
GET {{baseUrl}}/formularios/search?q=clinico
Authorization: Bearer {{token}}

### Obter estatísticas
GET {{baseUrl}}/formularios/estatisticas
Authorization: Bearer {{token}}

### Listar por tipo
GET {{baseUrl}}/formularios/tipo/anamnese
Authorization: Bearer {{token}}

### Listar formulários ativos
GET {{baseUrl}}/formularios/ativos
Authorization: Bearer {{token}}

### ==============================
### FLUXO DE VERSIONAMENTO
### ==============================

### 1. Buscar formulário original
GET {{baseUrl}}/formularios/codigo/ANAM_COMPLETA_001
Authorization: Bearer {{token}}

### 2. Criar nova versão
POST {{baseUrl}}/formularios/{{$guid}}/criar-versao
Authorization: Bearer {{token}}

### 3. Verificar nova versão criada
GET {{baseUrl}}/formularios/codigo/ANAM_COMPLETA_001_V2
Authorization: Bearer {{token}}

### 4. Atualizar nova versão
PATCH {{baseUrl}}/formularios/{{$guid}}
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "nomeFormulario": "Anamnese Completa V2 - Clínica Geral",
  "observacoes": "Versão 2 com melhorias baseadas no feedback dos profissionais"
}

### ===========================
### CENÁRIOS DE ERRO COMUNS
### ===========================

### Tentar criar formulário com código duplicado
POST {{baseUrl}}/formularios
Content-Type: {{contentType}}
Authorization: Bearer {{token}}

{
  "codigoFormulario": "ANAM_COMPLETA_001",
  "nomeFormulario": "Formulário Duplicado",
  "tipo": "anamnese"
}

### Expected Response: 400 Bad Request

###

### Buscar formulário inexistente
GET {{baseUrl}}/formularios/codigo/CODIGO_INEXISTENTE
Authorization: Bearer {{token}}

### Expected Response: 404 Not Found

###

### Tentar publicar formulário sem campos
POST {{baseUrl}}/formularios/{{$guid}}/publicar
Authorization: Bearer {{token}}

### Expected Response: 400 Bad Request

###

### Tentar excluir formulário publicado
DELETE {{baseUrl}}/formularios/{{$guid}}
Authorization: Bearer {{token}}

### Expected Response: 400 Bad Request (se publicado)

###